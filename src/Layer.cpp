#include "Layer.hpp"

namespace Layers {

// FOR TESTING
template <typename T>
DenseLayer<T>::DenseLayer(int num, int numInputs, int numNeurons,
                          T pWeightRegularizerL1, T pWeightRegularizerL2,
                          T pBiasRegularizerL1, T pBiasRegularizerL2)
    : weightRegularizerL1{pWeightRegularizerL1},
      weightRegularizerL2{pWeightRegularizerL2},
      biasRegularizerL1{pBiasRegularizerL1},
      biasRegularizerL2{pBiasRegularizerL2}, ModelLayer<T>{} {
    for (int i = 0; i < numInputs; i++) {
        weightMomentums.push_back(std::vector<T>(numNeurons, 0.0));
        weightCache.push_back(weightMomentums[i]);
    }
    
    if (num == 0) {
        weights = {
            {-1.30652683e-02, 1.65813062e-02,  -1.18164043e-03, -6.80178218e-03,
             6.66383095e-03,  -4.60719783e-03, -1.33425845e-02, -1.34671740e-02,
             6.93773152e-03,  -1.59573427e-03, -1.33701565e-03, 1.07774371e-02,
             -1.12682581e-02, -7.30677694e-03, -3.84879787e-03, 9.43515857e-04,
             -4.21714503e-04, -2.86887190e-03, -6.16264006e-04, -1.07305276e-03,
             -7.19604362e-03, -8.12993012e-03, 2.74516339e-03,  -8.90915096e-03,
             -1.15735531e-02, -3.12292250e-03, -1.57667010e-03, 2.25672331e-02,
             -7.04700267e-03, 9.43260733e-03,  7.47188320e-03,  -1.18894493e-02,
             7.73252966e-03,  -1.18388068e-02, -2.65917219e-02, 6.06319541e-03,
             -1.75589062e-02, 4.50934470e-03,  -6.84010889e-03, 1.65955070e-02,
             1.06850928e-02,  -4.53385804e-03, -6.87837601e-03, -1.21407732e-02,
             -4.40922612e-03, -2.80355476e-03, -3.64693534e-03, 1.56703859e-03,
             5.78521471e-03,  3.49654467e-03,  -7.64143933e-03, -1.43779144e-02,
             1.36453183e-02,  -6.89449161e-03, -6.52293628e-03, -5.21189300e-03,
             -1.84306949e-02, -4.77973977e-03, -4.79655806e-03, 6.20358298e-03,
             6.98457099e-03,  3.77088909e-05,  9.31848306e-03,  3.39964987e-03,
             -1.56821116e-04, 1.60928175e-03,  -1.90653489e-03, -3.94849479e-03,
             -2.67733540e-03, -1.12801129e-02, 2.80441693e-03,  -9.93123557e-03,
             8.41631275e-03,  -2.49458570e-03, 4.94949811e-04,  4.93836775e-03,
             6.43314468e-03,  -1.57062337e-02, -2.06903671e-03, 8.80178902e-03,
             -1.69810578e-02, 3.87280458e-03,  -2.25556418e-02, -1.02250678e-02,
             3.86305532e-04,  -1.65671520e-02, -9.85510740e-03, -1.47183500e-02,
             1.64813492e-02,  1.64227746e-03,  5.67290280e-03,  -2.22675106e-03,
             -3.53431748e-03, -1.61647405e-02, -2.91837356e-03, -7.61492178e-03,
             8.57923925e-03,  1.14110177e-02,  1.46657871e-02,  8.52551963e-03,
             -5.98653918e-03, -1.11589693e-02, 7.66663160e-03,  3.56292794e-03,
             -1.76853836e-02, 3.55481799e-03,  8.14519823e-03,  5.89255884e-04,
             -1.85053668e-03, -8.07648432e-03, -1.44653469e-02, 8.00297968e-03,
             -3.09114461e-03, -2.33466644e-03, 1.73272118e-02,  6.84501091e-03,
             3.70824989e-03,  1.42061792e-03,  1.51999481e-02,  1.71958935e-02,
             9.29505099e-03,  5.82224596e-03,  -2.09460296e-02, 1.23721908e-03,
             -1.30106951e-03, 9.39532300e-04,  9.43046063e-03,  -2.73967721e-02,
             -5.69312042e-03, 2.69904337e-03,  -4.66845511e-03, -1.41690606e-02,
             8.68963450e-03,  2.76871910e-03,  -9.71104577e-03, 3.14817182e-03,
             8.21585674e-03,  5.29264616e-05,  8.00564792e-03,  7.82601768e-04,
             -3.95228993e-03, -1.15942042e-02, -8.59307649e-04, 1.94292923e-03,
             8.75832699e-03,  -1.15107466e-03, 4.57415590e-03,  -9.64611955e-03,
             -7.82629102e-03, -1.10389292e-03, -1.05462847e-02, 8.20247829e-03,
             4.63130325e-03,  2.79095769e-03,  3.38904094e-03,  2.02104356e-02,
             -4.68864199e-03, -2.20144130e-02, 1.99300190e-03,  -5.06035401e-04,
             -5.17519051e-03, -9.78829805e-03, -4.39189514e-03, 1.81338424e-03,
             -5.02816681e-03, 2.41245367e-02,  -9.60504357e-03, -7.93117285e-03,
             -2.28861999e-02, 2.51484429e-03,  -2.01640651e-02, -5.39454632e-03,
             -2.75670527e-03, -7.09727919e-03, 1.73887257e-02,  9.94394347e-03,
             1.31913684e-02,  -8.82418826e-03, 1.12859402e-02,  4.96000936e-03,
             7.71405920e-03,  1.02943880e-02,  -9.08763241e-03, -4.24317596e-03,
             8.62595998e-03,  -2.65561901e-02, 1.51332803e-02,  5.53132035e-03,
             -4.57039627e-04, 2.20507639e-03,  -1.02993520e-02, -3.49943363e-03,
             1.10028433e-02,  1.29802199e-02,  2.69622393e-02,  -7.39246665e-04,
             -6.58552907e-03, -5.14233951e-03, -1.01804184e-02, -7.78547488e-04,
             3.82732414e-03,  -3.42422776e-04, 1.09634679e-02,  -2.34215800e-03,
             -3.47450632e-03, -5.81268454e-03, -1.63263455e-02, -1.56776775e-02,
             -1.17915794e-02, 1.30142802e-02,  8.95260274e-03,  1.37496404e-02,
             -1.33221159e-02, -1.96862463e-02, -6.60056295e-03, 1.75818941e-03,
             4.98690270e-03,  1.04797222e-02,  2.84279673e-03,  1.74266864e-02,
             -2.22605676e-03, -9.13079176e-03, -1.68121830e-02, -8.88971332e-03,
             2.42117955e-03,  -8.88720248e-03, 9.36742499e-03,  1.41232759e-02,
             -2.36958694e-02, 8.64052307e-03,  -2.23960392e-02, 4.01499076e-03,
             1.22487051e-02,  6.48561050e-04,  -1.27968919e-02, -5.85431186e-03,
             -2.61645438e-03, -1.82244775e-03, -2.02896819e-03, -1.09882781e-03,
             2.13480042e-03,  -1.20857367e-02, -2.42019817e-03, 1.51826115e-02,
             -3.84645420e-03, -4.43836069e-03, 1.07819736e-02,  -2.55918447e-02,
             1.18137859e-02,  -6.31903764e-03, 1.63928559e-03,  9.63213562e-04,
             9.42468084e-03,  -2.67594750e-03, -6.78025745e-03, 1.29784578e-02,
             -2.36417390e-02, 2.03341813e-04,  -1.34792542e-02, -7.61573343e-03,
             2.01125666e-02,  -4.45954269e-04, 1.95069693e-03,  -1.78156272e-02,
             -7.29044667e-03, 1.96557399e-03,  3.54757695e-03,  6.16886560e-03,
             8.62789893e-05,  5.27004153e-03,  4.53781895e-03,  -1.82974041e-02,
             3.70057212e-04,  7.67902425e-03,  5.89879788e-03,  -3.63858812e-03,
             -8.05626530e-03, -1.11831184e-02, -1.31054013e-03, 1.13307983e-02,
             -1.95180420e-02, -6.59891730e-03, -1.13980239e-02, 7.84957502e-03,
             -5.54309599e-03, -4.70637623e-03, -2.16949568e-03, 4.45393240e-03,
             -3.92388972e-03, -3.04614305e-02, 5.43311890e-03,  4.39042924e-03,
             -2.19541020e-03, -1.08403657e-02, 3.51780117e-03,  3.79235530e-03,
             -4.70032869e-03, -2.16731476e-03, -9.30156466e-03, -1.78589090e-03,
             -1.55042931e-02, 4.17318800e-03,  -9.44368448e-03, 2.38103140e-03,
             -1.40596293e-02, -5.90057671e-03, -1.10489398e-03, -1.66069977e-02,
             1.15147873e-03,  -3.79147544e-03, -1.74235608e-02, -1.30324280e-02,
             6.05120044e-03,  8.95555969e-03,  -1.31908641e-03, 4.04761825e-03,
             2.23843544e-03,  3.29622976e-03,  1.28598399e-02,  -1.50699839e-02,
             6.76460750e-03,  -3.82008962e-03, -2.24258914e-03, -3.02249729e-03,
             -3.75147094e-03, -1.22619616e-02, 1.83339184e-03,  1.67094301e-02,
             -5.61330176e-04, -1.38504274e-05, -6.87299017e-03, -1.17474550e-03,
             4.66166437e-03,  -3.70242447e-03, -4.53804014e-03, 4.03264537e-03,
             -9.18004755e-03, 2.52496614e-03,  8.20321776e-03,  1.35994852e-02,
             -9.03820095e-04, 1.36759719e-02,  1.03440983e-02,  -9.96212661e-03,
             -1.21793849e-02, -3.04963649e-03, 1.02893552e-02,  -7.22870056e-04,
             -6.00657566e-03, 1.55224316e-02,  2.86904466e-03,  -2.32059434e-02,
             3.17160622e-03,  5.20040607e-03,  2.25608656e-03,  4.49712109e-03,
             -6.72756054e-04, -1.31839579e-02, -3.70703987e-03, -9.45615768e-03,
             -9.32740886e-03, -1.26306824e-02, 4.52489080e-03,  9.78961471e-04,
             -4.48165368e-03, -6.49337936e-03, -2.34231047e-04, 1.07919481e-02,
             -2.00421568e-02, 3.76876513e-03,  -5.45712002e-03, -1.88458581e-02,
             -1.94570292e-02, -9.12783481e-03, 2.19509541e-03,  3.93062923e-03,
             -9.38981585e-03, 1.01702092e-02,  1.42298350e-02,  3.96086555e-03,
             -5.91402641e-03, 1.12441918e-02,  7.55395694e-03,  8.67407396e-03,
             -6.56463671e-03, -2.83455439e-02, 2.11679097e-02,  -1.61087830e-02,
             -3.57680721e-04, 2.38074530e-02,  3.30576743e-03,  9.49246436e-03,
             -1.50239654e-02, -1.77766681e-02, -5.32702776e-03, 1.09074973e-02,
             -3.46249458e-03, -7.94636272e-03, 1.97967282e-03,  1.08193513e-02,
             -1.44494018e-02, -1.21054305e-02, -7.88669195e-03, 1.09463828e-02,
             2.34821532e-03,  2.13215351e-02,  9.36445687e-03,  -3.50951770e-04,
             1.26507776e-02,  2.11497000e-03,  -7.04921363e-03, 6.79974817e-03,
             -6.96326653e-03, -2.90397112e-03, 1.32778268e-02,  -1.01281481e-03,
             -8.03141389e-03, -4.64337645e-03, 1.02179060e-02,  -5.52540645e-03,
             -3.86870862e-03, -5.10292780e-03, 1.83925487e-03,  -3.85489757e-03,
             -1.60183609e-02, -8.87180865e-03, -9.32789035e-03, 1.24331936e-02,
             8.12674034e-03,  5.87259326e-03,  -5.05358307e-03, -8.15791544e-03,
             -5.07517578e-03, -1.05188014e-02, 2.49720048e-02,  -2.24532168e-02,
             5.64008532e-03,  -1.28455227e-02, -1.04343484e-03, -9.88001935e-03,
             -1.17762899e-02, -1.14019634e-02, 1.75498612e-02,  -1.32988417e-03,
             -7.65702175e-03, 5.55786956e-03,  1.03493141e-04,  7.20033748e-03,
             -1.82425659e-02, 3.03603918e-03,  7.72694824e-03,  -1.66159831e-02,
             4.48195264e-03,  1.69618148e-02,  -1.48577034e-04, 8.21405929e-03,
             6.70570415e-03,  -7.07505690e-03, 3.97667347e-04,  -1.56699456e-02,
             -4.51303041e-03, 2.65687960e-03,  7.23100454e-03,  2.46121257e-04,
             7.19983736e-03,  -1.10290619e-02, -1.01697270e-03, 1.92793843e-04,
             1.84959117e-02,  -2.14166660e-03, -4.99016652e-03, 2.13512234e-04,
             -9.19113401e-03, 1.92753843e-03,  -3.65055189e-03, -1.79132763e-02,
             -5.85865520e-04, -3.17543093e-03, -1.63242333e-02, -6.71341550e-04,
             1.48935588e-02,  5.21303760e-03,  6.11927221e-03,  -1.34149669e-02,
             4.76898346e-03,  1.48449582e-03,  5.29045193e-03,  4.22628596e-03,
             -1.35978060e-02, -4.14008129e-04, -7.57870823e-03, -5.00840950e-04,
             -8.97400919e-03, 1.31247025e-02,  -8.58972315e-03, -8.98942165e-03,
             7.45864061e-04,  -1.07709905e-02, -4.24663303e-03, -8.29964597e-03,
             1.41117200e-02,  7.85803795e-03,  -5.74695179e-04, -3.91217042e-03,
             9.40917619e-03,  4.05204063e-03,  4.98052407e-03,  -2.61922367e-04,
             -1.68823004e-02, -1.12465979e-03, -5.32489875e-03, 6.45055296e-03},
            {1.01184249e-02,  -6.57951040e-03, 4.68385220e-03,
             1.73587892e-02,  -6.67712744e-03, 1.68192163e-02,
             -8.52585863e-03, 2.29597557e-04,  -1.11456116e-04,
             1.14989001e-04,  -8.37677997e-03, -5.91183128e-03,
             -6.67720241e-03, 3.26962583e-03,  3.30035109e-03,
             2.22594421e-02,  1.37098897e-02,  -5.09843230e-03,
             3.24869598e-03,  9.97118000e-03,  3.06018221e-04,
             -6.96415722e-04, 5.15749387e-04,  8.67276546e-03,
             -8.48320499e-03, -3.25669465e-03, 4.70433151e-03,
             3.11447075e-03,  2.39582756e-03,  -3.69801163e-03,
             9.72535741e-03,  2.13386826e-02,  4.06415481e-03,
             -1.93176698e-03, 7.55740283e-03,  -5.39132627e-03,
             -7.49690318e-03, 3.28087452e-04,  -2.58279648e-02,
             -1.15395030e-02, -3.47961835e-03, -1.35338884e-02,
             -1.03264302e-02, -4.36748331e-03, -1.64296534e-02,
             -4.06071777e-03, -5.35270153e-03, 2.54052080e-04,
             1.15418397e-02,  1.72504410e-03,  2.10620216e-04,
             9.94544476e-04,  2.27392768e-03,  -1.01673864e-02,
             -1.14775321e-03, 3.08751245e-03,  -1.37075996e-02,
             8.65652878e-03,  1.08137606e-02,  -6.31375937e-03,
             -2.41337786e-03, -8.78190342e-03, 6.99380459e-03,
             -1.06122233e-02, -2.22476991e-03, -8.58919881e-03,
             5.09542762e-04,  -1.79422926e-02, 1.32646160e-02,
             -9.64606367e-03, 5.98946819e-04,  -2.12523038e-03,
             -7.62114488e-03, -8.87780078e-03, 9.36398562e-03,
             -5.25640603e-03, 2.71170191e-03,  -8.01496860e-03,
             -6.47181459e-03, 4.72247135e-03,  9.30408482e-03,
             -1.75316399e-03, -1.42191974e-02, 1.99795607e-02,
             -8.56549293e-03, -1.54158734e-02, 2.59442441e-02,
             -4.04032273e-03, -1.46173267e-02, -6.83439756e-03,
             3.67544871e-03,  1.90311542e-03,  -8.51729233e-03,
             1.82272363e-02,  -5.21579664e-03, -1.18468655e-02,
             9.60693415e-03,  1.32906279e-02,  -8.17493070e-03,
             -1.40134729e-02, 1.03043830e-02,  -2.04732362e-02,
             -1.22662159e-02, 9.67446156e-03,  -5.53525460e-04,
             -2.63937353e-03, 3.52816610e-03,  -1.52774423e-03,
             -1.29868668e-02, 1.27607537e-02,  1.32501395e-02,
             2.05332553e-03,  4.51340136e-04,  2.33962480e-02,
             -2.76432838e-03, -2.59576971e-03, 3.64481239e-03,
             1.47132194e-02,  1.59277059e-02,  -2.58572632e-03,
             3.08331242e-03,  -1.37808342e-02, -3.11976089e-03,
             -8.40290356e-03, -1.00683179e-02, 1.68157667e-02,
             -7.92286638e-03, -5.31605911e-03, 3.65848769e-03,
             1.29782520e-02,  4.81115142e-03,  2.75935493e-02,
             -7.46679725e-04, 2.58716429e-03,  2.75600655e-03,
             1.43504934e-02,  5.07238926e-03,  -1.16229698e-03,
             -9.47488565e-03, 2.44443445e-03,  1.40134478e-02,
             -4.10381798e-03, 5.28943585e-03,  2.46147765e-03,
             8.63519683e-03,  -8.04753695e-03, 2.34664697e-02,
             -1.27916103e-02, -3.65551072e-03, 9.38092545e-03,
             2.96733156e-03,  8.29986110e-03,  -4.96102311e-03,
             -7.48049817e-04, 1.22319834e-04,  1.56925954e-02,
             6.90429006e-03,  7.96672050e-03,  -6.57926081e-03,
             9.68882628e-03,  2.25581648e-03,  1.38914539e-02,
             2.01406013e-02,  -3.06765758e-03, -4.06303117e-03,
             -8.64044949e-03, -1.43579510e-03, -3.82025447e-03,
             3.59504391e-03,  -1.44566817e-03, -3.61599261e-03,
             1.06458506e-02,  -9.37880203e-03, 4.33107931e-03,
             -4.05941717e-03, 7.24368496e-03,  1.38526149e-02,
             -3.03098257e-03, 4.41032927e-03,  1.78792863e-03,
             -7.99422339e-03, 2.40787491e-03,  2.89120479e-03,
             4.12870804e-03,  -1.98398903e-03, 9.41923005e-04,
             -1.14761088e-02, -3.58114066e-03, 5.55962650e-03,
             8.92473850e-03,  -4.22314834e-03, 1.04714022e-03,
             2.28053331e-03,  2.01479928e-03,  5.40773571e-03,
             -1.81807764e-02, -4.93240659e-04, 2.39033578e-03,
             -1.00033032e-02, 1.67398565e-02,  1.61559263e-03,
             1.56340469e-02,  -7.90522993e-03, -9.07300133e-03,
             2.24252208e-03,  -1.67868845e-02, 2.14965595e-03,
             9.72192269e-04,  1.01566529e-02,  7.01041333e-03,
             -4.17477312e-03, -1.09749660e-02, 1.71230510e-02,
             -7.92114995e-03, -1.04552461e-02, -1.08485604e-02,
             1.11730527e-02,  -5.18900203e-03, -7.53704458e-03,
             1.37689826e-03,  -2.06944696e-03, -6.78095454e-03,
             7.53991446e-03,  1.06531549e-02,  9.85317491e-03,
             7.66919646e-03,  4.02625510e-03,  -1.77588798e-02,
             1.66925080e-02,  3.01989191e-03,  6.08156435e-03,
             1.11496234e-02,  1.43335247e-02,  4.18398017e-03,
             4.35546134e-03,  -5.99224260e-03, 3.30897485e-04,
             -8.54161289e-03, -7.19940523e-03, -8.93574394e-03,
             -1.56023889e-03, 1.04909325e-02,  3.17097455e-02,
             1.89499627e-03,  -1.34841306e-02, 1.26498323e-02,
             -3.00783874e-03, -6.60608569e-03, 2.09849468e-03,
             -1.24062449e-02, 2.22463161e-03,  -8.83755216e-04,
             9.83779086e-04,  3.81416245e-03,  6.74922543e-04,
             1.63380842e-04,  2.84314505e-03,  4.15400602e-03,
             -1.03148241e-02, -1.42999124e-02, -6.16380537e-04,
             -1.43273538e-02, 8.75314698e-04,  9.38746892e-03,
             6.07111678e-03,  -1.04817040e-02, -8.60262476e-03,
             3.28301266e-03,  -4.01297817e-03, -3.16655310e-03,
             5.96906478e-03,  -9.87286679e-03, -4.01234720e-03,
             -8.00082460e-03, -1.04312943e-02, -8.57078191e-03,
             6.77462155e-03,  5.18203888e-04,  -8.79160594e-03,
             -2.31101597e-03, -1.63880717e-02, -7.33312778e-03,
             2.14957446e-02,  -9.02438420e-04, 7.31658936e-03,
             -6.54883741e-04, 3.48169240e-03,  6.63258042e-03,
             -1.10461665e-02, -3.09362571e-04, 1.57886520e-02,
             -7.95500539e-03, -5.66439843e-03, -3.07691260e-03,
             2.69024074e-03,  5.24917850e-03,  1.26741165e-02,
             4.99498239e-03,  -6.20531267e-04, 1.25916703e-02,
             7.04111019e-03,  -1.49567947e-02, 2.52636801e-02,
             1.76992137e-02,  -1.68214215e-03, 3.77910095e-03,
             1.32435868e-02,  -1.72200799e-03, 7.30351778e-03,
             1.10457847e-02,  -1.01482589e-02, -6.02331851e-03,
             9.21408366e-03,  4.60814452e-03,  9.23796557e-03,
             -1.32568018e-03, -2.89005204e-03, -1.99863948e-02,
             -1.14600034e-02, 4.70660947e-04,  8.24557245e-03,
             5.31178340e-03,  -1.28241966e-03, -2.71771569e-03,
             2.17179628e-03,  7.82111776e-04,  1.40454555e-02,
             1.46440766e-03,  -1.48124592e-02, -1.27255805e-02,
             1.51875932e-02,  -1.17116040e-02, 7.64497463e-03,
             -2.68372730e-03, -1.69758289e-03, -1.34132779e-03,
             1.22138495e-02,  -1.92841829e-03, -3.33192816e-04,
             -1.53080337e-02, 2.06690491e-03,  5.31042507e-03,
             2.39145570e-03,  1.39789628e-02,  5.51713572e-04,
             2.98977457e-03,  1.64850391e-02,  -1.55001413e-02,
             -4.55825357e-03, 1.42615875e-02,  9.36129130e-03,
             6.78380067e-03,  8.32650717e-03,  3.27066216e-03,
             1.63159743e-02,  3.77759151e-03,  2.39867112e-03,
             1.58958673e-03,  1.92863948e-03,  -1.15701724e-02,
             7.70673016e-03,  -1.30439724e-03, 1.82191506e-02,
             -7.56504654e-04, 4.20918269e-03,  2.46602180e-03,
             -6.25556987e-03, 9.92136821e-03,  1.90506354e-02,
             -1.47772196e-04, -3.00478772e-03, -3.55028710e-03,
             -1.89236179e-02, -1.77813135e-03, 2.50998093e-03,
             1.05475793e-02,  9.60047729e-03,  -4.16499050e-03,
             -2.76822969e-03, 1.12390528e-02,  -1.73463894e-03,
             -5.10029541e-03, 1.39251836e-02,  1.03758555e-02,
             1.87917904e-04,  -5.93777420e-03, -2.01188028e-02,
             5.89703629e-03,  -8.96369666e-03, -1.96273196e-02,
             1.58482045e-02,  6.47967821e-03,  -1.13900816e-02,
             -1.21440133e-02, 8.70961789e-03,  -8.77970643e-03,
             1.29614985e-02,  6.16459316e-03,  5.36596542e-03,
             4.04695421e-03,  1.91450876e-03,  8.80511198e-03,
             -4.54080384e-03, 8.59519758e-04,  7.51946541e-03,
             5.62989712e-03,  -1.19498679e-02, -5.00409631e-03,
             2.52803508e-03,  -4.08014702e-03, 1.77465845e-02,
             -3.93153168e-03, -1.62218453e-03, 7.69430166e-03,
             3.30532715e-03,  -1.45274459e-03, -7.56493490e-03,
             3.01514054e-03,  1.03909643e-02,  4.79095196e-03,
             -7.78183481e-03, 1.73677485e-02,  -1.44657791e-02,
             -1.58268549e-02, 9.60557163e-03,  2.25840486e-03,
             -5.49498526e-03, -1.09857069e-02, 2.32079979e-02,
             1.17090868e-03,  5.34201134e-03,  3.17885098e-03,
             4.34807967e-03,  5.40094404e-03,  7.32424017e-03,
             -3.75222415e-03, -2.91641965e-03, -1.74102280e-02,
             -7.80304428e-03, 2.71112798e-03,  1.04502328e-02,
             5.99039532e-03,  -3.40692326e-03, -1.26317283e-02,
             -2.77735926e-02, 1.15173394e-02,  -5.89228980e-03,
             -4.48465021e-03, 1.31573970e-03,  -1.40555995e-02,
             -3.49782151e-03, 2.02347171e-02,  5.05386945e-03,
             3.59249138e-03,  -1.58249438e-02, 2.24360172e-02,
             -1.42279491e-02, 1.92232467e-02,  -2.11505592e-02,
             1.40536539e-02,  1.61805432e-02,  -8.24409071e-03,
             4.22580354e-03,  5.47480583e-03,  -8.13794509e-03,
             -1.44911762e-02, -1.31771732e-02, 5.41008217e-03,
             -8.51156015e-04, -5.64301014e-03, 9.66767967e-03,
             5.08067897e-03,  -7.55462702e-03, -1.20120151e-02,
             5.23261726e-03,  -5.37583325e-03, 9.92048532e-04,
             1.57629885e-02,  5.02328202e-03,  -8.62266961e-03,
             1.60661188e-03,  -9.52644926e-03, 1.60852205e-02,
             -5.61578758e-03, 2.07270728e-03,  3.07732564e-03,
             1.59250468e-03,  -1.95854884e-02, -1.44642098e-02,
             -4.52350266e-03, 3.19431839e-03,  -1.37779221e-03,
             -9.57147498e-03, -1.34842433e-02, -4.01557516e-03,
             -4.68476024e-03, 5.12836454e-03,  -3.26318457e-03,
             6.02707686e-03,  -5.94649790e-03, -2.55957665e-03,
             -3.48046375e-03, -7.82366935e-03, 6.25118660e-03,
             -8.13595951e-03, -5.21641504e-03, -7.31196487e-04,
             -1.29737956e-02, -3.24934954e-03, -7.11306324e-03,
             -3.88154178e-03, -5.99280000e-04}};
    } else {
        weights = {{-7.99913611e-03, -2.20075785e-03, 1.30866868e-02},
                   {-2.57985579e-04, 1.14526208e-02, 3.46494420e-03},
                   {7.74160586e-03, -7.74458935e-03, 1.04907155e-03},
                   {1.33912917e-03, -6.12625713e-03, -8.22828338e-03},
                   {-1.49026532e-02, 1.49613963e-02, -9.72402841e-03},
                   {1.34622110e-02, -4.67493152e-03, -8.62493273e-03},
                   {6.22519106e-03, -6.31191954e-03, 5.68458904e-03},
                   {-3.32811754e-03, 4.80424473e-03, -9.68186092e-03},
                   {8.31351057e-03, 4.87972656e-03, -9.19650681e-03},
                   {2.64293570e-02, 5.40123042e-03, 2.29046699e-02},
                   {1.60026774e-02, -1.88834779e-03, -4.12271777e-03},
                   {-4.03459184e-03, -1.83002856e-02, -6.95835100e-03},
                   {2.46766023e-03, 1.52595751e-02, -7.72771891e-03},
                   {8.82056542e-03, -1.25259338e-02, -5.86320041e-03},
                   {-4.57640598e-03, 3.71811073e-03, 4.57309606e-03},
                   {9.62341670e-03, 7.70836929e-03, 2.43168208e-03},
                   {3.90364928e-03, 1.58853065e-02, -5.10926172e-03},
                   {7.74728274e-03, -1.80814397e-02, 4.11334215e-03},
                   {-4.83249547e-03, 2.57118227e-05, 1.04008624e-02},
                   {1.64643803e-03, 8.85187555e-03, 1.47376470e-02},
                   {3.89093952e-03, 1.17104100e-02, -3.26560973e-03},
                   {-8.20988207e-05, -5.22619393e-03, 1.04297753e-02},
                   {4.14091349e-03, -5.07234456e-03, 1.54668838e-03},
                   {1.04156835e-02, -3.92679911e-04, -9.48932767e-03},
                   {1.31911749e-03, -1.98056549e-02, 7.68770603e-03},
                   {-4.21327585e-03, -4.69310721e-03, 8.75695702e-03},
                   {-1.36516280e-02, 1.94709860e-02, -4.80242027e-03},
                   {-5.23250923e-03, 1.02122473e-02, 7.08695268e-03},
                   {2.45122984e-02, -2.11205985e-03, -1.20406633e-03},
                   {-1.47931594e-02, -3.32102273e-03, -7.21431291e-03},
                   {-4.48767003e-03, -1.74418762e-02, 1.66060757e-02},
                   {-1.41660338e-02, -2.80220266e-02, -1.18842442e-02},
                   {-6.03839569e-03, -1.14955399e-02, 1.09830350e-02},
                   {-1.37839175e-03, 2.53856037e-04, 6.10391703e-03},
                   {2.86012515e-03, 9.78567265e-03, -1.10947751e-02},
                   {-5.47518069e-03, 6.65967166e-03, -2.53455434e-02},
                   {-1.37518449e-02, 5.00992220e-03, -4.80249058e-03},
                   {9.36107524e-03, 8.09180271e-03, -1.19809294e-02},
                   {4.06657113e-03, 1.20169781e-02, 1.47434394e-03},
                   {-9.77464858e-03, 8.79389886e-03, 6.35424536e-03},
                   {5.42610744e-03, 7.15938862e-03, -2.99461279e-02},
                   {8.80937558e-03, 1.80813186e-02, 4.36638482e-03},
                   {1.92728988e-03, 6.96438644e-03, 3.38225486e-03},
                   {6.51781261e-03, 1.47100027e-05, -7.66704837e-03},
                   {-1.00432271e-02, -9.98191722e-03, -1.37304254e-02},
                   {-1.06774196e-02, 1.76126603e-02, 7.54095661e-03},
                   {-6.25027390e-03, -3.90392682e-03, 1.12557528e-03},
                   {-6.55545061e-03, 6.75168529e-04, 7.77604152e-03},
                   {-3.57427314e-04, 3.36015713e-03, 8.86491500e-03},
                   {-2.72131758e-03, 2.84790597e-03, -3.09377583e-03},
                   {-2.85288697e-04, -3.24730272e-03, -5.28869871e-03},
                   {1.73711847e-03, 5.66545315e-03, 1.46304443e-03},
                   {4.98726964e-03, -7.37931766e-03, -1.20373517e-02},
                   {4.17043502e-03, 6.87881373e-03, 4.98572655e-04},
                   {1.34803578e-02, 9.07698832e-03, 2.68057082e-02},
                   {-2.00808514e-03, -9.98848770e-03, -7.40136765e-03},
                   {-5.65497810e-03, 4.76031378e-03, -2.15806868e-02},
                   {1.31855104e-02, -2.39296583e-03, -2.46793544e-03},
                   {-1.07934317e-02, -1.14225550e-03, 1.32397676e-04},
                   {-1.21944922e-03, 3.39059252e-03, -5.89632010e-03},
                   {-8.95815808e-03, 5.48328087e-03, 9.86674451e-04},
                   {1.97181059e-03, 1.05902720e-02, -1.02256443e-02},
                   {-8.55240412e-03, 1.25721963e-02, -1.48288328e-02},
                   {-1.30941207e-02, 8.17861874e-03, 2.38200184e-03},
                   {1.05232128e-03, -9.16594116e-04, 3.12675460e-04},
                   {-9.21121158e-04, 1.35544259e-02, -3.98148131e-03},
                   {-1.61373534e-03, 1.79444887e-02, 2.75097031e-04},
                   {2.23201625e-02, -1.04979693e-03, 1.36741493e-02},
                   {-1.65534392e-02, 1.53644453e-03, -1.58447362e-02},
                   {8.44454300e-03, -1.21286782e-02, 2.83769541e-03},
                   {-2.82195862e-03, -1.15820318e-02, -1.61935985e-02},
                   {-5.11040445e-03, 1.74062941e-02, -2.93485029e-03},
                   {9.17221513e-03, -5.70428674e-04, 8.76726769e-03},
                   {-1.82691123e-02, -4.03188309e-03, 9.49405506e-03},
                   {-1.63254945e-03, -8.64552858e-04, -4.30461904e-03},
                   {1.14937937e-02, 2.97514349e-03, 4.40222764e-04},
                   {6.43054536e-03, 5.88224921e-03, 2.12587044e-03},
                   {1.54703148e-02, -6.02875312e-04, 2.78081046e-03},
                   {-6.42952556e-03, 1.50115218e-03, 1.58776157e-02},
                   {-6.43257610e-03, -1.13359280e-02, 9.96759627e-03},
                   {-1.48766139e-03, 9.60042002e-04, -4.51133004e-04},
                   {7.91217200e-04, 8.50530621e-03, -8.39124154e-03},
                   {-1.01177404e-02, 8.49681324e-04, -1.60643961e-02},
                   {-1.37305353e-02, 1.86668299e-02, 7.57468306e-03},
                   {-1.00564714e-04, 1.23800691e-02, -1.04059922e-02},
                   {-3.15603125e-03, 6.23453595e-03, 8.90671648e-03},
                   {5.12916874e-03, -2.54123881e-02, -9.68082063e-03},
                   {4.77068080e-03, -3.55951488e-03, 2.54023168e-02},
                   {9.26558301e-03, 5.58081875e-03, -1.11694951e-02},
                   {-3.52967385e-04, 2.41203955e-03, 1.12778367e-02},
                   {8.81131086e-03, 1.03298910e-02, -9.23911948e-03},
                   {1.41215166e-02, -1.38043063e-02, -5.35914535e-03},
                   {4.30771150e-03, -1.49891584e-03, -1.00603681e-02},
                   {-8.21549818e-03, -1.54825430e-02, 5.31974621e-03},
                   {1.26056885e-02, -1.00393500e-03, -4.00348799e-03},
                   {-1.47232292e-02, 9.13201924e-03, 2.21130438e-02},
                   {-1.79745574e-02, -1.06343292e-02, -6.79593021e-03},
                   {-5.64317871e-03, 2.27345945e-03, 1.61424950e-02},
                   {1.00859720e-02, 5.27597358e-03, -7.23928679e-03},
                   {-1.11962818e-02, -7.96775240e-03, 1.54806683e-02},
                   {-6.17432990e-04, -4.46836231e-03, -1.83755718e-03},
                   {8.24618246e-03, -1.31284958e-02, 1.41487401e-02},
                   {1.56476256e-03, -2.16343976e-03, 4.42846119e-03},
                   {2.18397053e-03, -3.44196451e-03, -2.52710655e-03},
                   {-8.68862588e-03, 6.56390702e-03, -5.31993806e-03},
                   {-9.56258364e-03, 1.65863521e-03, 1.32914120e-02},
                   {-4.83446231e-04, -6.08101254e-03, 4.03896021e-03},
                   {1.93671249e-02, -1.45190544e-02, 3.82202771e-03},
                   {2.05086614e-03, 1.16153378e-02, 9.90909152e-03},
                   {-1.86709105e-03, -1.68451723e-02, 8.06563813e-03},
                   {-8.35192669e-03, -9.46740340e-03, 1.14835054e-02},
                   {-9.10850428e-03, 1.40284477e-02, 3.35844723e-03},
                   {3.19118402e-03, 3.07264761e-03, -1.63842365e-02},
                   {-1.77638866e-02, 2.15553050e-03, 5.68007352e-03},
                   {8.26110307e-04, -8.21534451e-03, 1.89221028e-04},
                   {-8.20341520e-04, -9.57158022e-03, 1.01397214e-02},
                   {-1.73027609e-02, 5.88742411e-03, 3.84323415e-03},
                   {1.00971181e-02, -1.00531187e-02, 1.01407140e-03},
                   {2.17116494e-02, 6.62074238e-03, 1.00581208e-03},
                   {5.39161265e-03, 8.61768378e-04, 2.19089780e-02},
                   {9.83636174e-03, -8.56149534e-04, 2.52331421e-03},
                   {-3.90797993e-03, 1.20985005e-02, -1.40610477e-02},
                   {-1.60473846e-02, 1.45871472e-02, 2.15311982e-02},
                   {4.68304893e-03, 1.12737936e-03, 6.57267682e-03},
                   {-6.47053542e-03, 1.71243539e-03, 3.89087043e-04},
                   {6.26564259e-03, -1.55799855e-02, -5.07034780e-03},
                   {8.44995584e-03, -6.75593829e-03, -9.93361324e-03},
                   {2.04207208e-02, 3.81179998e-04, -5.78918168e-03},
                   {-1.69237033e-02, 7.29346322e-03, 6.99136127e-03},
                   {-2.98759597e-03, -1.10223014e-02, -2.45494215e-04},
                   {-8.35856050e-03, -9.42093600e-03, -1.03212753e-03},
                   {-1.05139036e-02, 2.46648956e-03, 6.07992522e-03},
                   {-8.39632470e-03, -1.36824511e-02, 1.56127959e-02},
                   {-9.40270256e-03, -6.59942674e-03, 2.13017152e-03},
                   {5.99369314e-03, -2.56316899e-03, 4.60794335e-03},
                   {-4.00986150e-03, -9.71170608e-03, 1.42631680e-02},
                   {2.48844158e-02, 1.69596951e-02, 1.41806633e-03},
                   {1.83343533e-02, 3.55703500e-03, -4.77286289e-03},
                   {4.66379570e-03, -9.43925057e-04, -9.83118173e-03},
                   {-8.98321997e-03, 8.02051742e-03, -1.84653196e-02},
                   {6.04136754e-03, -1.62958354e-02, -2.12117638e-02},
                   {-1.83884650e-02, 1.96676385e-02, -1.96233951e-03},
                   {8.65831797e-04, 1.41925495e-02, 9.34179686e-03},
                   {-1.39150517e-02, 8.69006291e-03, 1.84181251e-03},
                   {-3.41678085e-03, 2.42909126e-04, 1.27981193e-02},
                   {-8.85966420e-03, 4.00885660e-03, -9.65723666e-05},
                   {-1.79716460e-02, -8.02253187e-03, 1.93213543e-03},
                   {1.29734203e-02, 1.00133093e-02, 5.97212464e-03},
                   {-8.15275684e-03, 1.80121399e-02, 2.15240452e-03},
                   {-1.00636547e-02, -1.82904967e-03, 8.96248408e-03},
                   {7.61749834e-05, 8.86864681e-03, 1.10369390e-02},
                   {4.00530687e-03, -8.57702550e-03, 1.35454664e-03},
                   {4.51658532e-04, 1.85934640e-02, -1.62632186e-02},
                   {-1.34822458e-03, -5.84093574e-03, 3.35105625e-03},
                   {-2.43756436e-02, 1.11492453e-02, 1.37484865e-04},
                   {-1.84470117e-02, -3.61113134e-03, 6.08962355e-03},
                   {-1.59144774e-02, 3.22221640e-05, -1.05747366e-02},
                   {-5.55985002e-03, 2.67383817e-04, 1.83450244e-03},
                   {-4.70742490e-03, 2.72796396e-03, 8.17977544e-03},
                   {-2.78914277e-03, 1.43156778e-02, 1.46221407e-02},
                   {-4.28702030e-03, -6.37840573e-03, -1.66417304e-02},
                   {-1.26569322e-03, -3.63437762e-03, 7.79051241e-03},
                   {-1.50966151e-02, -2.77391402e-03, 9.68744420e-03},
                   {-7.30357086e-03, -7.62361521e-03, -1.44694028e-02},
                   {2.62057371e-02, -7.47473165e-03, -1.30034685e-02},
                   {-8.03850405e-03, -7.74295069e-03, -2.69389781e-03},
                   {8.25372245e-03, -2.98323156e-03, -9.22823325e-03},
                   {-1.45133846e-02, 2.18573579e-04, 4.25390754e-04},
                   {1.53093226e-02, 9.24477354e-04, -9.90083092e-04},
                   {-1.05065377e-02, -3.05952574e-03, -4.38474445e-03},
                   {-3.70164146e-03, -9.59255360e-03, 5.38329594e-03},
                   {-1.42445415e-03, -2.00353470e-03, -1.71404611e-02},
                   {4.93644085e-03, 4.87015303e-03, -8.39129370e-03},
                   {9.90121346e-03, -1.36475824e-02, -2.18699090e-04},
                   {-2.71207327e-03, -1.31717473e-02, 1.89702609e-03},
                   {1.70257017e-02, 6.76342286e-04, -4.63021733e-03},
                   {4.47024172e-03, 1.05720002e-03, 2.77621322e-04},
                   {-4.25542193e-03, 1.42197562e-02, 4.56363335e-03},
                   {-5.28670661e-03, -1.08003838e-03, -7.40866689e-03},
                   {-6.08291151e-03, -6.40725717e-03, -1.13431150e-02},
                   {7.77276978e-03, -2.91041448e-03, 5.54127572e-03},
                   {-6.70125894e-03, -6.03624969e-04, -7.11040618e-03},
                   {7.19668111e-03, -2.48419284e-03, -7.30873551e-03},
                   {-1.64170321e-02, 2.75666523e-03, -7.08385045e-03},
                   {-1.57792179e-04, -4.91730077e-03, 9.54189617e-03},
                   {5.44144725e-03, 4.47212113e-03, -6.16121106e-03},
                   {4.66290023e-03, 1.71483159e-02, -8.32185987e-03},
                   {1.72339135e-03, -1.64921694e-02, 1.39856208e-02},
                   {-3.97912087e-03, 7.82578904e-03, -1.72322821e-02},
                   {1.79753937e-02, -3.56871518e-03, 5.45657333e-03},
                   {1.50818191e-03, -2.55470769e-03, 1.68579221e-02},
                   {-1.64804626e-02, 2.98713637e-03, 9.10645630e-03},
                   {-2.98561208e-04, -1.18170783e-03, -1.42687710e-03},
                   {-1.22763645e-02, 3.81273829e-04, 5.12717525e-03},
                   {6.85992243e-04, -2.72276090e-03, -4.89725033e-03},
                   {-2.79296655e-03, 1.25774415e-02, -2.08663475e-02},
                   {4.00714576e-04, -3.27754905e-03, 1.45580787e-02},
                   {5.54922270e-04, 1.48492558e-02, -2.12388989e-02},
                   {4.59584873e-03, 2.80057848e-03, 1.39053389e-02},
                   {-1.64134856e-02, -1.55035802e-03, 6.60602585e-04},
                   {-4.95795486e-03, 1.21657774e-02, -3.38682160e-03},
                   {2.03476250e-02, 1.05417790e-02, 9.50833689e-03},
                   {5.59298974e-03, -1.06369555e-02, -4.31096321e-03},
                   {5.72751323e-03, 6.77557057e-03, 1.30718388e-02},
                   {-4.67440998e-03, -8.60153325e-03, 8.59104190e-03},
                   {-8.09626561e-03, 8.73311795e-03, 1.19973607e-02},
                   {4.56153043e-03, -3.57579021e-03, 4.10822249e-04},
                   {5.93465893e-03, 1.01855177e-04, 2.19829623e-02},
                   {-9.90670919e-03, -1.00266859e-02, -9.76895355e-03},
                   {-5.89579949e-03, -2.17893142e-02, -6.29650382e-03},
                   {-6.53284695e-03, 7.85140204e-04, 4.17800574e-03},
                   {-1.24021638e-02, 9.00054164e-03, 1.80224217e-02},
                   {-2.08285102e-03, 1.57437120e-02, 1.98989501e-03},
                   {1.98873188e-02, 1.11728348e-02, -1.56390462e-02},
                   {1.86273697e-04, 1.05432495e-02, 3.05465801e-04},
                   {-3.68835288e-04, 1.26976473e-02, -7.09854160e-03},
                   {1.75156121e-04, 3.23625770e-03, -3.33790947e-03},
                   {-2.01291026e-04, 7.75023270e-03, 4.32837615e-03},
                   {-8.08717497e-03, -1.10412389e-02, -7.89102167e-03},
                   {1.24845583e-05, -1.59939774e-03, -8.31957534e-03},
                   {-5.98150399e-03, -1.52003933e-02, 4.17853706e-03},
                   {-4.00187244e-04, -1.25978729e-02, 2.86205031e-04},
                   {1.34262200e-02, -7.39935879e-03, 1.31513756e-02},
                   {-3.23457480e-03, 1.97828165e-03, 9.77508025e-04},
                   {1.40152341e-02, 1.58433837e-03, -1.14190131e-02},
                   {-1.31097035e-02, -1.53292101e-02, -1.71197020e-02},
                   {4.61350603e-04, -9.58374515e-03, -8.08116107e-04},
                   {-7.03859003e-03, -7.70784309e-03, -4.80845338e-03},
                   {7.03585567e-03, 9.29145142e-03, 3.71172535e-03},
                   {-9.89822578e-03, 6.43631257e-03, 6.88896654e-03},
                   {2.74647190e-03, -6.03620382e-03, 7.08859554e-03},
                   {4.22818540e-03, -3.11685652e-02, 6.44452032e-03},
                   {-1.91374253e-02, 6.63561560e-03, -1.54072396e-03},
                   {1.19361160e-02, -9.81612131e-04, -8.86614248e-03},
                   {-1.47353660e-03, 1.05980635e-02, 2.62466172e-04},
                   {-1.14335155e-03, 7.43553508e-03, 2.10359367e-03},
                   {-5.92740580e-05, 1.36605995e-02, 1.55511396e-02},
                   {6.13326253e-03, -2.85959151e-03, 1.49691105e-02},
                   {1.18311951e-02, 7.18897162e-03, -1.21607659e-02},
                   {1.40671909e-03, -7.43672159e-03, -1.59012259e-03},
                   {2.40056915e-03, 1.00159401e-03, -4.75175120e-03},
                   {1.27295367e-02, -1.69613119e-02, 7.30183534e-03},
                   {-1.85748320e-02, 3.82598117e-03, -8.86904262e-03},
                   {8.78303777e-03, 8.64525209e-04, 2.47706380e-03},
                   {-1.01827933e-02, -6.54570153e-03, 2.07217387e-03},
                   {5.83569938e-03, 2.92909611e-02, 2.22858321e-03},
                   {9.76037513e-03, -1.55693386e-02, -1.32989185e-02},
                   {-3.55494767e-03, -1.19742770e-02, 1.48639930e-02},
                   {-4.10218677e-03, 1.38218189e-02, 1.48678236e-02},
                   {4.27797204e-04, 5.01799770e-03, -5.60994726e-04},
                   {5.38436975e-03, 4.83341841e-03, -1.23649626e-03},
                   {5.04969945e-03, 1.72369611e-02, 7.13016186e-03},
                   {3.25799617e-03, 1.24769518e-03, -1.01267314e-02},
                   {-1.02729686e-02, 3.23356525e-03, -1.36939101e-02},
                   {-7.66327605e-03, 1.28151132e-02, 1.91422962e-02},
                   {-1.66595597e-02, 1.62664950e-02, -2.11438304e-03},
                   {-1.50050866e-04, -1.13411620e-03, 1.08054411e-02},
                   {-1.60767660e-02, 4.56163613e-03, -9.44870152e-03},
                   {5.70788467e-03, 1.54279638e-02, -4.17326373e-06},
                   {3.74155072e-03, 4.09551756e-03, -7.99593516e-03},
                   {1.51163936e-02, 1.70646813e-02, 7.01783365e-03},
                   {7.32854300e-04, -4.61893808e-03, -6.26490219e-03},
                   {1.71083640e-02, 1.41441496e-02, -6.36614859e-04},
                   {-1.57993045e-02, -2.83201188e-02, -1.08342664e-02},
                   {-1.30620389e-03, 1.40068894e-02, -6.51656184e-03},
                   {5.04815439e-03, 1.30318087e-02, 1.28536311e-03},
                   {-1.42447872e-03, -1.30876349e-02, -1.20247528e-02},
                   {4.16099606e-03, -2.00907513e-03, 1.22531317e-03},
                   {-4.72777145e-04, 6.64144009e-03, -7.84687418e-03},
                   {-3.35580646e-03, 1.89618208e-02, -7.99786113e-03},
                   {-2.81575439e-03, -5.89386700e-03, 4.44781361e-03},
                   {1.02239223e-02, -4.98211617e-03, -4.31414321e-03},
                   {-2.78981589e-03, 5.29833790e-03, -7.39395292e-03},
                   {-3.75959952e-03, -2.37219371e-02, -1.38174491e-02},
                   {-1.12443755e-03, 8.97864159e-03, 2.95075774e-03},
                   {-1.09876841e-02, -1.40025616e-02, 1.74680096e-03},
                   {-1.65280364e-02, 1.06592681e-02, 6.38961908e-04},
                   {-1.60732009e-02, -9.65953898e-03, -7.24311266e-03},
                   {-7.73192523e-03, -1.48993302e-02, -8.74662492e-03},
                   {-6.84401579e-03, -7.11285742e-03, 1.12795662e-02},
                   {1.04827806e-03, -9.93257202e-03, -3.34621593e-03},
                   {-8.79557058e-03, -3.00006662e-03, 8.75509158e-03},
                   {2.52270792e-03, 2.28560101e-02, 3.75927403e-03},
                   {-9.13594477e-03, 8.09740741e-03, 1.07993120e-02},
                   {1.09416693e-02, -1.09424088e-02, -1.47637411e-03},
                   {1.13181192e-02, -1.68472901e-02, -4.99416748e-03},
                   {-1.42693771e-02, -9.32570174e-03, -1.01245707e-02},
                   {1.25056980e-02, -2.34538037e-03, -8.63355584e-03},
                   {-1.03560574e-02, 1.41667167e-03, -1.11356276e-04},
                   {1.34407431e-02, 5.00016659e-03, -1.43179772e-02},
                   {-6.28980668e-03, 1.07007250e-02, -6.21082727e-03},
                   {1.73457209e-02, -1.09828943e-02, 5.72613347e-03},
                   {-8.61215498e-03, -5.09595126e-03, 1.09858168e-02},
                   {-1.27067161e-03, 8.13452248e-03, 4.73290589e-03},
                   {7.53865624e-03, -8.88188183e-03, -2.21574400e-03},
                   {4.24252637e-03, -8.49072821e-03, 1.62949990e-02},
                   {-7.77228037e-03, -3.00003588e-03, -1.00655900e-02},
                   {-2.14330815e-02, 1.79691855e-02, -2.04338925e-03},
                   {-4.47914843e-03, -1.98715064e-03, 1.41986394e-02},
                   {-9.65106580e-03, 6.79567875e-03, -4.23788233e-03},
                   {-5.96670853e-03, 5.67058194e-03, 9.88240540e-03},
                   {-5.13902958e-03, -7.68849114e-03, -1.16909575e-02},
                   {1.10350382e-02, -5.75255975e-03, -1.84913073e-02},
                   {1.40995216e-02, -1.36985946e-02, 7.79460510e-03},
                   {1.83428638e-03, 2.87915440e-03, -5.84375253e-03},
                   {3.65591468e-03, -1.66777987e-02, 5.88037726e-03},
                   {1.55701004e-02, 8.84027127e-03, -2.01954003e-02},
                   {-9.84208938e-03, -1.87794922e-03, 4.86937305e-03},
                   {-1.06652675e-03, -4.93214373e-03, 5.95300319e-03},
                   {1.16415173e-02, -2.32293992e-03, 7.28929881e-03},
                   {-2.57905070e-02, -9.37509350e-03, -3.21258930e-03},
                   {-4.88566188e-03, 3.32798203e-03, 1.01375049e-02},
                   {5.06669050e-03, -6.22225460e-03, -1.52276810e-02},
                   {5.56964101e-03, -1.83817670e-02, 6.53037289e-03},
                   {-1.88449083e-03, -1.17583498e-02, 2.87257298e-03},
                   {-2.87610255e-05, -3.65972926e-04, -8.42232956e-04},
                   {4.19524079e-03, 9.24433954e-03, 4.96615190e-03},
                   {1.01213325e-02, -4.41397191e-04, 1.61845926e-02},
                   {5.71109820e-03, -5.43694012e-03, -1.09389508e-02},
                   {2.05796794e-03, -1.30652152e-02, -9.73375980e-03},
                   {2.39087059e-03, -6.07887423e-03, -9.33316164e-03},
                   {-3.44750471e-04, 7.26778933e-04, -2.05834024e-03},
                   {-3.77546903e-03, 8.54642689e-03, 3.42427334e-03},
                   {-2.23426125e-03, 2.46432181e-02, 1.93831732e-03},
                   {1.13200508e-02, -5.60980942e-03, -1.36294086e-02},
                   {-7.91756529e-03, -2.68009771e-03, -4.96608205e-03},
                   {1.33638615e-02, -1.20041124e-03, 4.61468846e-03},
                   {-4.64811543e-04, -4.33554314e-03, 3.79960111e-04},
                   {1.71405151e-02, -7.67948572e-03, 7.66990427e-03},
                   {-1.02600725e-02, -4.59626410e-03, 3.58320576e-05},
                   {3.26375081e-03, 1.48312859e-02, -5.00826398e-04},
                   {-8.43615551e-03, 6.50041969e-03, -3.64169804e-03},
                   {2.38681561e-03, -1.16222433e-03, -1.94345675e-02},
                   {5.08299144e-03, 5.83367981e-03, 9.26604681e-03},
                   {1.80046260e-02, -1.19510377e-02, 5.16507449e-03},
                   {4.09294991e-03, -4.19081980e-03, 3.97106213e-03},
                   {4.99646971e-03, -1.21868383e-02, 2.46222760e-03},
                   {-9.17984266e-03, -6.51856465e-03, -1.77474488e-02},
                   {-4.73360904e-03, -2.03570677e-03, 5.49856806e-03},
                   {8.99926636e-06, -1.54228816e-02, 8.62148032e-03},
                   {-1.18586619e-03, 4.88370564e-03, 9.65936109e-03},
                   {1.42260473e-02, 1.96122695e-02, -7.22387573e-04},
                   {3.11124441e-03, -1.07836099e-02, 1.06160017e-02},
                   {-1.18488735e-02, -1.80525165e-02, 8.30385927e-03},
                   {-5.21696499e-03, 7.77607225e-03, 4.08074632e-03},
                   {-1.63000263e-02, -2.71967929e-02, -1.09660169e-02},
                   {1.64914876e-04, -1.22177638e-02, -6.52761431e-03},
                   {-1.45894075e-02, 1.69877952e-03, 9.08259302e-04},
                   {-4.81392629e-03, 1.39706526e-02, 1.49771497e-02},
                   {5.65267215e-03, -1.79977119e-02, -1.10469013e-02},
                   {4.07130318e-03, -6.28557568e-03, -4.87091392e-03},
                   {8.98967404e-03, 5.10874810e-03, 1.31415436e-02},
                   {-4.29209275e-03, 1.37522537e-02, -5.54131251e-03},
                   {1.49949146e-02, 1.05834636e-03, -8.60509742e-03},
                   {-1.63121950e-02, -3.01472307e-03, -2.56232708e-03},
                   {8.57661851e-03, -1.10590504e-03, -4.32431977e-03},
                   {1.07703740e-02, -2.24826555e-03, -5.76241780e-03},
                   {5.74608892e-03, -4.89828223e-03, 6.58802129e-03},
                   {-5.96917095e-03, -2.22959160e-03, 1.52176968e-03},
                   {-3.74126318e-03, -1.34514688e-04, 8.15471914e-03},
                   {4.10601776e-03, 4.80969856e-03, -6.35430450e-03},
                   {8.52829777e-03, 6.69562304e-03, 1.00441920e-02},
                   {-7.26365810e-03, -1.72458601e-03, 6.33533858e-03},
                   {-6.08815113e-03, -2.26122467e-03, 1.92580558e-02},
                   {1.95176098e-02, 1.23994052e-02, 9.38585121e-03},
                   {-1.01925107e-02, 5.12562227e-03, -3.59116565e-03},
                   {-1.05857188e-02, -5.09005832e-03, 1.15665072e-03},
                   {-5.47355600e-03, -5.50799398e-03, 7.92041421e-03},
                   {1.44106487e-03, 2.33458076e-03, 1.11872400e-03},
                   {-6.75703166e-03, -1.37057193e-02, 3.10564693e-03},
                   {-5.07036597e-03, -2.01078225e-02, -3.92567227e-03},
                   {-1.09221786e-02, 6.98650209e-03, 5.21625206e-03},
                   {4.96893143e-03, -6.65041618e-03, 7.31551554e-03},
                   {3.19649768e-03, -4.09854529e-03, -4.53337422e-03},
                   {8.92708171e-03, -4.73604025e-03, 3.03656445e-03},
                   {1.03395702e-02, 1.90934259e-02, 1.66387297e-02},
                   {9.00822785e-03, -1.50591135e-02, -6.89048413e-03},
                   {-5.48087154e-03, 1.65314972e-02, -6.99317921e-03},
                   {3.86166363e-03, 1.00867066e-03, -9.35127214e-03},
                   {3.81824002e-03, 3.98296071e-03, -1.25577487e-02},
                   {1.22287748e-02, -2.08650995e-02, -5.90757141e-03},
                   {9.71970335e-03, -1.19325779e-02, 3.50265903e-03},
                   {-1.29636033e-02, -9.30241426e-04, -2.31377315e-02},
                   {-8.42571631e-03, -1.54292136e-02, -4.01763711e-03},
                   {-4.15231381e-03, -6.73664128e-03, 7.97913130e-03},
                   {-8.86879582e-03, 6.34386623e-03, 1.62927583e-02},
                   {1.39064144e-03, -8.57670140e-03, -1.24933850e-02},
                   {-7.09785102e-03, 7.04642711e-03, 1.55590719e-03},
                   {9.36795212e-03, 7.70330895e-03, 1.40810653e-03},
                   {4.73488262e-03, 1.85524616e-02, 1.41565613e-02},
                   {-3.02746031e-03, 9.89679433e-03, 5.85850840e-03},
                   {1.13638807e-02, 6.71616523e-03, -9.74167418e-03},
                   {-1.61968451e-02, 5.72626991e-03, 1.90261807e-02},
                   {-7.75664067e-03, -1.88089744e-03, -1.03574777e-02},
                   {1.17782950e-02, -2.30516698e-02, -2.26366017e-02},
                   {3.75019899e-03, -8.23436421e-04, -4.79623023e-03},
                   {-3.01094796e-03, 5.36987884e-03, -4.13803989e-03},
                   {-1.09692495e-02, -9.27362870e-03, 8.88338871e-03},
                   {-5.24741923e-03, -1.38527760e-02, 1.02178322e-03},
                   {5.04994718e-03, 1.32896071e-02, 2.17903382e-03},
                   {-6.59711240e-03, 4.74007847e-03, 7.27174850e-03},
                   {-3.89053079e-04, -4.45993908e-04, 2.60132900e-03},
                   {-6.98564923e-04, 2.50113895e-03, -1.02191325e-02},
                   {-1.15043772e-02, -8.36111326e-03, 6.42210944e-03},
                   {2.58797547e-03, 1.04023898e-02, -1.86690921e-03},
                   {-1.14364130e-02, 1.14455353e-02, -1.87670550e-04},
                   {1.28345499e-02, 5.97946439e-03, 2.18861867e-02},
                   {-2.19772966e-03, 9.00723878e-03, 8.91364086e-03},
                   {-5.55126369e-03, -1.72482303e-03, -1.46173835e-02},
                   {-1.54879615e-02, 1.26568787e-03, 7.93007016e-03},
                   {6.38023997e-03, 3.40024591e-03, 8.63017142e-03},
                   {-5.89697761e-03, -2.72532762e-03, 7.37521518e-03},
                   {4.33118735e-03, -2.10188818e-03, 1.32079432e-02},
                   {-1.29200118e-02, -5.18678641e-03, -2.83397757e-03},
                   {8.16534832e-03, 2.38519788e-05, -1.26149170e-02},
                   {5.14004147e-03, 1.08754635e-02, 7.39304535e-03},
                   {6.19154936e-03, -1.87431350e-02, -8.99886433e-03},
                   {4.82080597e-03, -5.48881828e-04, 5.22557599e-03},
                   {-1.26634259e-02, -6.14947639e-04, -1.38978101e-02},
                   {-1.95367858e-02, 2.95779062e-03, 8.42588767e-03},
                   {2.45616422e-03, -3.29964794e-04, -1.56201432e-02},
                   {1.00610703e-02, -4.40448959e-04, 1.95956193e-02},
                   {9.42314323e-03, -2.00512540e-02, 7.55049707e-03},
                   {-1.39653524e-02, -7.59495469e-03, -2.50756671e-03},
                   {-9.40624450e-04, 3.97565216e-03, -1.02285501e-02},
                   {-1.15069197e-02, 6.00605179e-03, -1.32502682e-04},
                   {1.74373039e-03, -2.19368339e-02, -1.77137391e-03},
                   {-8.90729204e-03, -9.20626335e-03, 9.21934750e-03},
                   {-1.09567111e-02, -1.09289652e-02, -3.31010600e-03},
                   {4.50288830e-03, -8.84014741e-03, 1.23414407e-02},
                   {1.44984750e-02, -8.81447084e-03, -2.45081750e-03},
                   {-7.78675498e-03, -1.68538205e-02, 3.03011062e-03},
                   {7.33594876e-03, 2.01186407e-02, -8.97409488e-03},
                   {1.33623499e-02, 1.34235369e-02, 1.97853311e-03},
                   {6.02163468e-03, 8.73273052e-03, 1.97409987e-02},
                   {4.77808574e-03, -6.01378852e-04, -8.66168737e-03},
                   {3.05320765e-03, 1.02416491e-02, 2.44610338e-03},
                   {-7.79923238e-03, 8.90762021e-04, -1.29153475e-03},
                   {2.64738756e-03, -1.66184846e-02, 5.50788641e-03},
                   {5.95423160e-03, 4.44853399e-03, -3.76281714e-05},
                   {-1.80593617e-02, -1.93227912e-04, 1.06071495e-02},
                   {-8.60128831e-03, -1.98926944e-02, -1.54055795e-02},
                   {3.14025697e-03, 3.72876017e-03, 8.86293128e-03},
                   {-5.52589947e-04, -1.50032835e-02, -8.18504114e-03},
                   {8.18839390e-03, 1.40495913e-03, 6.49829628e-03},
                   {4.34788782e-03, -2.04960559e-03, -1.74006831e-03},
                   {1.85710229e-02, 4.14674263e-03, -1.28587545e-03},
                   {4.55419999e-03, 2.22905818e-03, -2.15735622e-02},
                   {6.50084484e-03, 1.82093922e-02, -7.80279841e-03},
                   {1.45403575e-02, -2.56869709e-03, 2.93471385e-03},
                   {1.07036000e-02, -7.20001431e-03, 1.24249384e-02},
                   {-1.21421730e-02, -8.75154696e-03, -5.93520328e-03},
                   {6.62005367e-03, -3.40874400e-03, -1.51997441e-02},
                   {-2.16532871e-03, -7.84221385e-03, 7.31293624e-03},
                   {-3.43235047e-03, 7.07740779e-04, -4.05472470e-03},
                   {4.33938950e-03, -1.83590769e-03, 3.25198704e-03},
                   {-2.59338841e-02, 9.72508744e-04, 4.13913652e-03},
                   {-1.99280051e-03, 6.69392431e-03, 7.38607021e-03},
                   {1.30421389e-02, 1.04811601e-03, -1.91380065e-02},
                   {-2.28549931e-02, -1.60184093e-02, -3.79070581e-04},
                   {-1.57305284e-03, 2.76239845e-03, -6.25245925e-03},
                   {-7.36491149e-03, 5.55047905e-03, 6.55924436e-03},
                   {-2.56650150e-03, -3.84766550e-04, 4.04314324e-03},
                   {5.04343538e-03, -1.14398068e-02, -7.19573861e-03},
                   {-1.23054599e-02, -5.06906630e-03, 8.12333543e-03},
                   {5.46271866e-03, -1.09809786e-02, 5.12266764e-03},
                   {8.58431042e-04, -4.93926695e-03, -1.40645970e-02},
                   {-1.74823368e-03, 6.79943943e-03, -2.16309763e-02},
                   {-3.96123203e-03, 2.25428361e-02, 6.72636740e-03},
                   {2.59832502e-03, -7.37185171e-03, -6.78329822e-03},
                   {-8.32883932e-04, 1.60286371e-02, 4.65589203e-03},
                   {-8.72158352e-03, 1.17678698e-02, -2.92594195e-03},
                   {1.69734638e-02, -5.66603011e-03, -1.00326575e-02},
                   {1.74629583e-03, 9.82326921e-03, 1.03744483e-02},
                   {1.59191771e-03, -9.88096651e-03, -5.05340705e-03},
                   {-2.01828182e-02, -9.13121458e-03, -1.78456807e-03},
                   {3.89002147e-03, -3.39454319e-03, -5.69790544e-04},
                   {-3.96185461e-03, 7.51025323e-03, -8.99112877e-03},
                   {8.37547891e-03, 1.96088068e-02, 4.72789630e-03},
                   {-5.27091604e-03, -5.36270114e-03, 1.20983720e-02},
                   {-1.12658935e-02, -9.53804422e-03, -1.16444845e-02},
                   {-1.27851376e-02, -1.04481634e-02, 7.89904967e-03},
                   {1.10228248e-02, -6.97073108e-03, 2.07334035e-03},
                   {7.59156700e-03, 1.00564200e-03, -9.54942778e-03},
                   {-1.47040170e-02, 1.01042753e-02, 4.96179378e-03},
                   {5.76955918e-03, -1.10764690e-02, 2.34977179e-03},
                   {6.28999574e-03, 3.14033823e-03, -7.45023182e-03},
                   {1.01226056e-02, -1.52763193e-02, 9.28741880e-03},
                   {1.08105596e-02, 1.57233030e-02, -3.42492177e-03},
                   {-9.99430008e-03, 7.93880317e-03, -6.99215289e-03},
                   {4.39955096e-04, -3.17462208e-03, -9.02071968e-03},
                   {3.20999464e-03, -1.39201591e-02, 5.92205673e-03},
                   {-9.66931041e-03, -1.73173118e-02, -5.01074595e-04},
                   {4.31633834e-03, 5.76934544e-03, 8.18353705e-03},
                   {-2.35364027e-02, -1.00514442e-02, 1.06652291e-03},
                   {1.51900323e-02, 7.83744454e-03, 1.90133993e-02},
                   {-5.24939410e-03, 2.74416967e-03, -1.09997075e-02},
                   {-4.04352229e-03, -7.35295704e-03, -6.33988669e-03},
                   {-3.93449096e-03, 2.71753979e-05, 2.22126633e-04},
                   {5.43453451e-03, 1.39988458e-03, -3.44045623e-03},
                   {-5.22578508e-03, -3.07131698e-03, -4.49037133e-03},
                   {4.90971049e-03, 8.65525194e-03, 1.27404444e-02},
                   {-7.97702745e-03, 4.69372189e-03, -1.39467968e-02},
                   {3.73174716e-03, 1.08267218e-02, -1.49589509e-03},
                   {1.07263597e-02, -1.13856792e-02, -8.88645276e-03},
                   {-1.35809835e-03, 1.02221034e-02, -4.17429442e-03},
                   {-4.53553116e-03, -9.91628319e-03, 2.02881033e-03},
                   {1.24669513e-02, 7.00680120e-03, 6.96650660e-03},
                   {-2.06974475e-03, -5.63309342e-03, 6.77245902e-03},
                   {-3.19110753e-04, -1.73608225e-03, 8.98240600e-03},
                   {-1.97787443e-03, -8.37776251e-03, 9.09188483e-03},
                   {8.07198870e-04, -1.03702936e-02, -1.11290580e-02}};
    }

    biases.push_back(std::vector<T>(numNeurons, 0.0));
    biasMomentums.push_back(biases[0]);
    biasCache.push_back(biases[0]);
    dBiases.push_back(std::vector<T>({}));

    isTrainable = true;
}

template <typename T>
DenseLayer<T>::DenseLayer(int numInputs, int numNeurons, T pWeightRegularizerL1,
                          T pWeightRegularizerL2, T pBiasRegularizerL1,
                          T pBiasRegularizerL2)
    : weightRegularizerL1{pWeightRegularizerL1},
      weightRegularizerL2{pWeightRegularizerL2},
      biasRegularizerL1{pBiasRegularizerL1},
      biasRegularizerL2{pBiasRegularizerL2}, ModelLayer<T>{} {
    std::random_device rd{};
    std::mt19937 gen{rd()};
    std::normal_distribution<T> distr(0.0, 1.0);
    weights.resize(numInputs, numNeurons);
    for (int i = 0; i < numInputs; i++) {
        for (int j = 0; j < numNeurons; j++) {
            weights[i][j] = 0.01 * distr(gen);
        }
        weightMomentums.push_back(std::vector<T>(numNeurons, 0.0));
        weightCache.push_back(weightMomentums[i]);
    }

    biases.push_back(std::vector<T>(numNeurons, 0.0));
    biasMomentums.push_back(biases[0]);
    biasCache.push_back(biases[0]);
    dBiases.push_back(std::vector<T>({}));

    isTrainable = true;
}

template <typename T>
void DenseLayer<T>::compute(const Vec2d<T> &pInputs, LayerMode mode) {
    inputs = pInputs;

    output = inputs * weights;
    for (int i = 0; i < output.size(); i++) {
        for (int j = 0; j < biases[0].size(); j++) {
            output[i][j] += biases[0][j];
        }
    }
}

template <typename T> void DenseLayer<T>::backward(const Vec2d<T> &dValues) {
    dWeights = transpose(inputs) * dValues;
    dBiases.clear();
    std::vector<T> sums(dValues[0].size(), 0.0);
    for (int i = 0; i < dValues[0].size(); i++) {
        for (int j = 0; j < dValues.size(); j++) {
            sums[i] += dValues[j][i];
        }
    }
    dBiases.push_back(sums);

    if (weightRegularizerL1 > 0) {
        Vec2d<T> dL1(weights.size(), weights[0].size());
        for (int i = 0; i < weights.size(); i++) {
            for (int j = 0; j < weights[i].size(); j++) {
                if (weights[i][j] < 0)
                    dL1[i][j] = -1;
            }
        }
        dWeights = dWeights + (weightRegularizerL1 * dL1);
    }
    if (weightRegularizerL2 > 0) {
        dWeights = dWeights + (2 * weightRegularizerL2 * weights);
    }
    if (biasRegularizerL1 > 0) {
        Vec2d<T> dL1(biases.size(), biases[0].size(), 1.0);
        for (int i = 0; i < biases.size(); i++) {
            for (int j = 0; j < biases[i].size(); j++) {
                if (biases[i][j] < 0)
                    dL1[i][j] = -1;
            }
        }
        dBiases = dBiases + (biasRegularizerL1 * dL1);
    }
    if (biasRegularizerL2 > 0) {
        dBiases = dBiases + (2 * biasRegularizerL2 * biases);
    }

    dInputs = dValues * transpose(weights);
}

template <typename T> Vec2d<T> &DenseLayer<T>::getWeights() { return weights; }

template <typename T> Vec2d<T> &DenseLayer<T>::getBiases() { return biases; }

template <typename T> Vec2d<T> &DenseLayer<T>::getDWeights() {
    return dWeights;
}

template <typename T> Vec2d<T> &DenseLayer<T>::getDBiases() { return dBiases; }

template <typename T> T DenseLayer<T>::getWeightRegularizerL1() {
    return weightRegularizerL1;
}

template <typename T> T DenseLayer<T>::getWeightRegularizerL2() {
    return weightRegularizerL2;
}

template <typename T> T DenseLayer<T>::getBiasRegularizerL1() {
    return biasRegularizerL1;
}

template <typename T> T DenseLayer<T>::getBiasRegularizerL2() {
    return biasRegularizerL2;
}

template <typename T> Vec2d<T> &DenseLayer<T>::getWeightMomentums() {
    return weightMomentums;
}

template <typename T> Vec2d<T> &DenseLayer<T>::getBiasMomentums() {
    return biasMomentums;
}

template <typename T> Vec2d<T> &DenseLayer<T>::getWeightCache() {
    return weightCache;
}

template <typename T> Vec2d<T> &DenseLayer<T>::getBiasCache() {
    return biasCache;
}

template <typename T>
void DenseLayer<T>::setWeightMomentums(const Vec2d<T> &newWeightMomentums) {
    weightMomentums = newWeightMomentums;
}

template <typename T>
void DenseLayer<T>::setBiasMomentums(const Vec2d<T> &newBiasMomentums) {
    biasMomentums = newBiasMomentums;
}

template <typename T>
void DenseLayer<T>::setWeights(const Vec2d<T> &newWeights) {
    weights = newWeights;
}

template <typename T> void DenseLayer<T>::setBiases(const Vec2d<T> &newBiases) {
    biases = newBiases;
}

template <typename T>
void DenseLayer<T>::setWeightCache(const Vec2d<T> &newWeightCache) {
    weightCache = newWeightCache;
}

template <typename T>
void DenseLayer<T>::setBiasCache(const Vec2d<T> &newBiasCache) {
    biasCache = newBiasCache;
}

template <typename T> DropoutLayer<T>::DropoutLayer(T pRate) : ModelLayer<T>{} {
    rate = 1.0 - pRate;
}

template <typename T>
void DropoutLayer<T>::compute(const Vec2d<T> &pInputs, LayerMode mode) {
    inputs = pInputs;

    if (mode == LayerMode::Eval) {
        output = inputs;
    } else {
        mask = Vec2d<T>(inputs.size(), inputs[0].size());
        std::random_device rd{};
        std::mt19937 gen{rd()};
        std::binomial_distribution<int> distr(1, rate);
        for (int i = 0; i < mask.size(); i++) {
            for (int j = 0; j < mask[i].size(); j++) {
                mask[i][j] = distr(gen);
            }
        }
        mask = mask / rate;

        if (output.size() != inputs.size() ||
            output[0].size() != inputs[0].size()) {
            // avoids a copy in all but the first iteration
            output = Vec2d<T>(inputs.size(), inputs[0].size());
        }
        for (int i = 0; i < output.size(); i++) {
            for (int j = 0; j < output[i].size(); j++) {
                output[i][j] = inputs[i][j] * mask[i][j];
            }
        }
    }
}

template <typename T> void DropoutLayer<T>::backward(const Vec2d<T> &dValues) {
    if (dInputs.size() != dValues.size() ||
        dInputs[0].size() != dValues[0].size()) {
        // avoids a copy in all but the first iteration
        dInputs = Vec2d<T>(dValues.size(), dValues[0].size());
    }
    for (int i = 0; i < dInputs.size(); i++) {
        for (int j = 0; j < dInputs[i].size(); j++) {
            dInputs[i][j] = dValues[i][j] * mask[i][j];
        }
    }
}

template <typename T> InputLayer<T>::InputLayer() : ModelLayer<T>{} {}

template <typename T>
void InputLayer<T>::compute(const Vec2d<T> &pInputs, LayerMode mode) {
    output = pInputs;
}

template <typename T> void InputLayer<T>::backward(const Vec2d<T> &dValues) {}

// Explicit instantiations
template class DenseLayer<double>;
template class DenseLayer<float>;
template class DropoutLayer<double>;
template class DropoutLayer<float>;
template class InputLayer<double>;
template class InputLayer<float>;

} // namespace Layers
